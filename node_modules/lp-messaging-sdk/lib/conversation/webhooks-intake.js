const ConversationNotificationFeed = require('./conversation-notification-feed');

/**
 * Ingests webhooks notifications
 * @category Conversation
 */
class WebhooksIntake extends ConversationNotificationFeed {

    async onNotification(notification) {

        if (!notification.wsNotificationMsg) {
            throw new Error('notification is missing wsNotificationMsg');
        }

        const type = notification.wsNotificationMsg.type;
        const body = notification.wsNotificationMsg.body;

        if (type === 'ms.MessagingEventNotification') {
            this.connection._onMessagingEventNotification(body);
        }
        else if (type === 'cqm.ExConversationChangeNotification') {
            await super.onNotification(body);
        }
        else {
            throw new Error(`invalid notification type ${type}`);
        }

    }

}

module.exports = WebhooksIntake;
