const ConversationSubscription = require("./conversation-subscription");

/**
 * An AAM subscription
 * @category Conversation
 */
class ChildConversationSubscription extends ConversationSubscription {

    constructor(connection, query, parentSubscription) {
        super(connection, query);
        this.parentSubscription = parentSubscription;
        this.hasReceivedInitialNotification = false;
    }

    async onNotification(notification) {
        if (this.hasReceivedInitialNotification) {
            return;
        }

        this.hasReceivedInitialNotification = true;

        // don't do normal subscription stuff, just re-route to the parent
        await this.parentSubscription.onNotification(notification);
        this.emit('notification', notification);
    }

}

module.exports = ChildConversationSubscription;
