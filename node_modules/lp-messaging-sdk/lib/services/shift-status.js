const axios = require('axios');
const CSDS = require('./csds-cache');
const {_cleanAxiosErrorForLogging} = require('./axiosHelper');

async function getShiftStatus(accountId, token) {

    const domain = await CSDS.lookup(accountId, CSDS.ServiceName.asyncMessagingEnt);
    const url = `${CSDS.defaultHttpProtocol}://${domain}/api/account/${accountId}/shift-status`;

    try {
        const shiftStatusResponse = await axios({
            method: 'get',
            url,
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        return shiftStatusResponse.data;

    } catch (err) {
        // catch axios errors, clean up and re-throw
        throw _cleanAxiosErrorForLogging(err);
    }
}

module.exports = {
    getShiftStatus
}
