const {send} = require("../restRequestHelper");
const HttpMethod = require("../http-method");
const getSingleParticipant = require("./get-single-participant");

async function transferConversation({
    accountId,
    token,
    conversationId,
    skillId = null,
    agentId = null,
    removeAgentId = null
} = {}) {

    if (skillId === null && agentId === null && removeAgentId === null) {
        return;
    }

    const queryParameters = [];

    if (skillId !== null) {
        queryParameters.push(`transferToSkillId=${skillId}`);
    }

    if (agentId !== null) {

        if (agentId === removeAgentId) {
            throw new Error(`Cannot transfer to the same agent: ${agentId}`);
        }

        queryParameters.push(`transferToAgentId=${agentId}`);
    }

    const queryParameter = queryParameters.length > 0 ? '?' + queryParameters.join('&') : '';

    const path = `/v1/conversations/${conversationId}/dialogs/${conversationId}/participants/${removeAgentId}${queryParameter}`;

    // obtain the ParticipantEtag
    const get = await getSingleParticipant({accountId, token, agentId: removeAgentId, conversationId, dialogId: conversationId});

    const header = {};
    header['If-Match'] = get.headers.etag;

    return await send({accountId, token, path, header, method: HttpMethod.DELETE});
}

module.exports = transferConversation;
