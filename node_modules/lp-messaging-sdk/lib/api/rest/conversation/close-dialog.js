const {send} = require('../restRequestHelper');
const HttpMethod = require('../http-method');
const getDialogById = require('./get-dialog-by-id');
const DialogState = require('../../../conversation/dialog-state');

async function closeDialog({accountId, token, conversationId, dialogId, closeReason}) {

    const path = `/v1/conversations/${conversationId}/dialogs/${dialogId}`

    // obtain the DialogEtag
    const get = await getDialogById({accountId, token, conversationId, dialogId});

    const header = {};
    header['If-Match'] = get.headers.etag;

    const data = {
        state: DialogState.CLOSE,
        closeReason
    };

    return await send({accountId, token, path, header, data, method: HttpMethod.PATCH});
}

module.exports = closeDialog;
