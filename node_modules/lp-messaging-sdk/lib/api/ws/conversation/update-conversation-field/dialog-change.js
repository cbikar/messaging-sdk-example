const {updateConversationField, UpdateConversationFieldName, v2Context, v3Context} = require('./update-conversation-field');

/**
 * @private
 * @param conversationId {string}
 * @param dialogId {string}
 * @param changeType {DialogChangeType}
 * @param state {DialogState}
 * @param [closedBy] {DialogCloseReason}
 * @param closedCause {string}
 * @returns {object}
 */
function dialogChange(conversationId, dialogId, changeType, state, closedBy = null, closedCause = null) {
    const data = {
        field: UpdateConversationFieldName.DialogChange,
        type: changeType,
        dialog: {
            dialogId,
            state
        }
    };

    if (closedBy !== null) {
        data.dialog.closedBy = closedBy;
    }

    if (closedCause !== null) {
        data.dialog.closedCause = closedCause;
    }

    return updateConversationField.call(this, conversationId, [data]);
}

module.exports = {
    v2: dialogChange.bind(v2Context),
    v3: dialogChange.bind(v3Context)
};
