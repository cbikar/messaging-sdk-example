# Changelog for Messaging Platform SDK #

## 1.5.4
* Pass through getShiftStatus#response & getShiftStatus#error events to the connection

## 1.5.3
* TokenMaintainer fixes - prevent caching token generation errors to allow reconnections
* getToken now blocks until token generation succeeds or TokenMaintainer is stopped

## 1.5.2
* CO-6234 Add APIs to change TTR and ManualETTR of a conversation, which consequently emits `ttr-change` and `manual-ettr-change` events respectively
* Whitelist `dialog:close` event and bubble up to conversation & connection

## 1.5.1
* CO-6394 fix for conversation.sendRichText, metadata was populated with message audience
* expose ConversationContextType, add conversationContext and campaignInfo to readme

## 1.5.0
* shift-status polling now encapsulated and exposed in ```lpmsdk.ShiftStatusPoller```
* rest helper functions exposed through ```lpmsdk.rest```

## 1.4.6
* Bubble up dialog and conversation events to the connection. These will have a `conversation:` prefix to them e.g. `conversation:close`
* Minor refactor of `refreshSession` internal method

## 1.4.5
* Fix for serialization of rich content events

## 1.4.4
* `TokenMaintainer` ctor now expects an object. Also added `getAuthSessionInfo()` method and extended support for refreshing tokens when authSessionInfo is passed in ctor

## 1.4.3
* ```loadConversation(serializedConversationData)``` function on connection, which allows previously serialized conversations to be resumed by the connection.
* ```unload()``` function on conversation that allows a conversation to bemanually removed from the SDK's memory.

## 1.4.2
* Expose TokenMaintainer class

## 1.4.1
* Added a queue when processing onNotificationPart

## 1.4.0
* CO-6062 Create ConversationNotificationFeed, WebhooksIntake, and NullConnection classes to consume notifications from webhooks/kafka. Accessed via ```connection.processWebhooksNotification(notification)```

## 1.3.0
* Public documentation now available @ www.npmjs.com/package/lp-messaging-sdk
* Introduced TokenMaintainer class to keep bearer tokens valid
* TokenMaintainer now used in BrandWebsocketConnection & BrandRestConnection
* Bug fixes for `simple-websocket` library related to retrieving close and error codes
* CO-6063 Add `setCsat` function to conversation, available for consumers
* CO-6099 Expose `connection.getToken()` async method to obtain token from connection
* CO-5613 Static `deserialize` function to recreate a hydrated Conversation object from DB

## 1.2.31
* add "consumer" getter helper to dialog
* expose ParticipantChatState enum

## 1.2.30
* CO-5950 Always create context and attach clientProperties

## 1.2.29
* CO-5989 Add setNote function to conversation

## 1.2.28
* CO-5907 Allow campaignInfo argument on createConversation to pass through correctly
* CO-5880 RoutingTaskSubscriptions and Rings are now available
* Browser stand alone build is now available /web/lpm-sdk.js
* Websocket library "ws" has been replaced with "simple-websocket" for browser compatibility
* CO-5987 use v2.1 of the WS API to allow suggested agents
* Increased default wait to reconnect time to 2 seconds, as per UMS recommendation

## 1.2.23
* Added Conversation REST APIs under `lib/api/rest/conversation`

## 1.2.22
* Minor fix so `conversationContext` is passed in correctly when consumers create conversations

## 1.2.19
* BrandWebsocketConnection now emits `skill-entered-work-hours` and `skill-entered-off-hours` for any of its skills

## 1.2.18
* Allow access to `ParticipantRole` enum
* CO-5713 Added ability to attach metadata to messages in `sendMessage`, `sendPrivateMessage`, and `sendRichText`
* CO-5612 `serialize` method added for Conversation object to allow it to be persisted in DBs
* Added Messaging & General REST APIs under `lib/api/rest` 

## 1.2.17
* CO-5322: Subscriptions now have a process to get more than 1001 conversations, there is now no limit to the number 
  of conversations. This feature is enabled by default, but can be disabled by passing ```limitBreakEnabled: 
  false``` as an option to ```createConnection```
* CO-5603: Removed errors when receiving duplicate read or accept message notifications from UMS
* CO-5604: Fixed issue where onReconnect calls could be doubled up in certain scenarios

## 1.2.14
* CO-5512: ```maintainConnection``` is now true by default when calling ```createConnection```

## 1.2.11
* CO-4981: Added tracking info to WS connection URL params
* CO-5532: Mock stepup: automatic consumer take over
* CO-5463: Shift-status will now start and retrieve initial data before default subscription is created

## 1.2.10
* CO-5436: Skill.isInOffHours helper function

## 1.2.7
* CO-5517: Conversation Deleted Event

## 1.2.5
* CO-5295: Media Handler File upload requests
* CO-5013: Wait for the first MS notification

## 1.2.4
* CO-5322: Conversation subscriptions async .init() which must be called to create subscription

## 1.2.3
* _callShiftStatus now has a return value
* CO-5321: dialog.getAll() retrieves all messages

## 1.2.2
* CO-5470: Remove optional chaining parameter for compatibility with old versions of node.js
* CO-5470: add wait option to createSubscription

## 1.2.1

* CO-4978: dialog.setChatState function
* Shift-status poller

## 1.1.1

* CO-4866: Resubscribe Subscriptions on Reconnect
* CO-5232: Private messages
* CO-5154: Support for Multiple Dialogs of the same Type
